<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
  <title>Spatial Memory Test</title>
  <script src="https://webvr.donmccurdy.com/aframe-extras.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" integrity="sha384-MIwDKRSSImVFAZCVLtU0LMDdON6KVCrZHyVQQj6e8wIEJkW4tvwqXrbMIya1vriY" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/js/bootstrap.min.js" integrity="sha384-ux8v3A6CPtOTqOzMKiuo3d/DomGaaClxFYdCu2HPMBEkf6x2xiDyJ7gkXU0MWwaD" crossorigin="anonymous"></script>
</head>
<body>
  <a-scene physics id="a">
  <!-- Player -->
  <a-assets>
  <a-asset-item id="endo-obj" src="boy.obj"></a-asset-item>
</a-assets>
<a-entity position="33 0 -33" rotation="0 180 0" id="camera" camera="userHeight: 1.6" kinematic-body universal-controls="movementControls: custom, hmd;" listener>
</a-entity>

<!-- Ground -->
<a-grid static-body></a-grid>

<!-- Obstacles -->
<!-- Box -->
<a-entity obj-model="obj: url(boy.obj)" scale="0.3 0.3 0.3" rotation="-90 180 0" dynamic-body="shape: box; mass: 0" position="-10 0 20"></a-entity>
<!--<a-box static-body position="-8 0 -25" width="0.001" height="4" depth="0.001"></a-box> -->

<!-- The four outside walls -->
<a-box color="#abc" static-body position="-35 0 0" width="0.001" height="6" depth="70"></a-box>
<a-box color="#abc" static-body position="35 0 0" width="0.001" height="6" depth="70"></a-box>

<a-box color="#abc" static-body position="0 0 -35" width="70" height="6" depth="0.001"></a-box>
<a-box color="#abc" static-body position="0 0 35" width="70" height="6" depth="0.001"></a-box>

<!-- The maze walls -->

 <!-- 
<a-box color="#abc" static-body position="0 0 -20" width="0.001" height="6" depth="35"></a-box>
      <a-entity static-body color="#abc" obj-model="obj: #endo-obj" scale="0.1 0.1 0.1" rotation="-90 0 0" position="1 1 1" static-body></a-entity>
    -->
    <!-- Lighting -->
    <a-light type="ambient" color="#bbb"></a-light>
    <a-light color="#ccc" position="0 30 0" distance="100" intensity="0.4" type="point"></a-light>
    <a-light color="#ccc" position="3 10 -10" distance="50" intensity="0.4" type="point"></a-light>
  </a-scene>
  <div class="card card-block" style="position:absolute;left:0px;bottom:0px;width:250px;background-color:white;z-index:999">
    <h3 class="card-title">Control Panel:</h3>
    <img src="figure_1.png" alt="some_text" style="width:210px;height:170px;">
    <div class="form-group row">
      <label for="example-text-input" class="col-xs-7 col-form-label">Solution:</label>
      <div class="col-xs-5">
        <input class="form-control" type="text" id="x">
      </div>
    </div>
    <a id="nextButton" class="btn btn-success" style="float:right;color:white" >Next</a>
  </div>
</body>
<script>
var m = [[[1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 0, 1, 1]], [[0, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 1, 0, 1, 1]], [[0, 0, 1, 0, 1], [1, 0, 1, 1, 1], [1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1]], [[0, 0, 1, 1, 1], [1, 1, 0, 0, 1], [0, 1, 0, 0, 1], [0, 1, 0, 1, 1], [0, 0, 0, 1, 1]], [[0, 1, 1, 0, 1], [1, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 1, 0, 1], [1, 1, 1, 0, 1]]];

m = [[[1, 0, 1, 0, 1], [1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 1, 1, 1], [1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 0, 0, 1], [0, 0, 1, 1, 1], [1, 0, 1, 1, 1], [1, 0, 0, 1, 1]], [[0, 0, 1, 1, 1], [1, 1, 0, 0, 1], [0, 1, 0, 1, 1], [0, 1, 0, 1, 1], [0, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1], [0, 1, 0, 1, 1], [0, 1, 0, 1, 1]], [[0, 1, 1, 0, 1], [1, 0, 0, 1, 1], [0, 1, 0, 1, 1], [0, 1, 1, 0, 1], [1, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 0, 0, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1], [0, 1, 0, 1, 1]], [[0, 0, 0, 1, 1], [0, 1, 0, 1, 1], [0, 1, 1, 0, 1], [1, 0, 0, 0, 1], [0, 0, 1, 1, 1], [1, 0, 1, 0, 1], [1, 0, 0, 1, 1], [0, 1, 0, 1, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1]], [[0, 1, 1, 1, 1], [1, 1, 0, 0, 1], [0, 0, 1, 1, 1], [1, 0, 1, 0, 1], [1, 1, 0, 0, 1], [0, 0, 0, 1, 1], [0, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 1, 1, 0, 1], [1, 0, 0, 1, 1]], [[0, 1, 0, 1, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1], [0, 0, 1, 1, 1], [1, 0, 1, 0, 1], [1, 1, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 0, 1, 1], [0, 0, 1, 1, 1], [1, 1, 0, 0, 1]], [[0, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 0, 1, 1, 1], [1, 1, 1, 0, 1], [1, 0, 0, 1, 1], [0, 1, 0, 0, 1], [0, 1, 0, 1, 1], [0, 1, 0, 1, 1], [0, 1, 1, 0, 1], [1, 0, 0, 1, 1]], [[0, 0, 1, 1, 1], [1, 0, 0, 0, 1], [0, 1, 0, 1, 1], [0, 0, 0, 1, 1], [0, 1, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 0, 0, 1], [0, 1, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 0, 0, 1]], [[0, 1, 1, 1, 1], [1, 0, 0, 1, 1], [0, 1, 1, 0, 1], [1, 1, 0, 1, 1], [0, 0, 1, 1, 1], [1, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 0, 0, 1, 1], [0, 0, 0, 1, 1]], [[0, 1, 0, 0, 1], [0, 1, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 1, 0, 1], [1, 1, 0, 0, 1], [0, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 0, 1, 0, 1], [1, 1, 1, 0, 1], [1, 1, 1, 0, 1]]];
var rectangles = [];
console.log(m);
var inc = 6
var offs = -35;
var num_rows = m.length;
var num_cols = m[0].length;

function addRectangle(x1,x2,y1,y2) {
  x1 = x1 + offs;
  y1 = y1 + offs;
  x1 = -x1;
  x2 = x2 + offs;
  y2 = y2 + offs;
  x2 = -x2;
  if(x2 >x1) {
    var x1f = x1;
    var x2f = x2;
  } else {
    var x2f = x1;
    var x1f = x2;
  }
  if(y2 >y1) {
    var y1f = y1;
    var y2f = y2;
  } else {
    var y2f = y1;
    var y1f = y2;
  }
  var rectangle = {x1: x1f, x2: x2f, y1: y1f, y2: y2f};
  //console.log(rectangle)
  rectangles.push(rectangle);
}

function checkIfInRectangle(loc,x,y) {
 x1 = loc.x1;
 x2 = loc.x2;
 y1 = loc.y1;
 y2 = loc.y2;
   if ((x1 <= x) && (x <= x2) && 
       (y1 <= y) && (y <= y2)) {
     return true;
   } else {
     return false;
   }
}

function checkForCollision(x,y) {
  var flag = false
  var le = rectangles.length;
  for (var i = 0;i < le;i++) {
    if (checkIfInRectangle(rectangles[i],x,y)) {
      flag = true;
      break;
    }
  }
  rectangles.forEach(function(element) {
  });
  if(!flag){
  //console.log("NOOO COLLISION!!");
  }
  return flag;
}

function addWall(a,x,z,w,d) {
  var wallHeight = 6;
  x = x + offs;
  z = z + offs;
  x = -x;
  let b = document.createElement("a-box");
  b.setAttribute("position", {
      "x" : x,
      "y" : 0,
      "z" : z
  });
  b.setAttribute("width",w);
  b.setAttribute("depth",d);
  b.setAttribute("height",wallHeight);
  b.setAttribute("color","#abc");
  b.setAttribute("static-body","");
  a.appendChild(b);
}

function addMaze() {

  for (var row = 0;row<num_rows;row++) {
    for (var col = 0;col<num_cols;col++) {
      var cell_data = m[row][col];
      for (var i = inc*row+1;i < inc*row+inc-1;i++) {
        var wallSize = 1
        if (cell_data[0] == 0) {
          addWall(a,inc*row+inc/2,inc*col,inc,1);
          addRectangle(inc*row,inc*row+inc,inc*col-wallSize,inc*col+wallSize)
        }
        if (cell_data[1] == 0) {
          addWall(a,inc*row,inc*col+inc/2,1,inc);
          addRectangle(inc*row-wallSize,inc*row+wallSize,inc*col,inc*col+inc)
        }
        if (cell_data[2] == 0) { 
          addWall(a,inc*row+inc/2,inc*col + inc - 1,inc,1);
          addRectangle(inc*row,inc*row+inc,inc*col + inc - 1-wallSize,inc*col + inc - 1+wallSize)
        }
        if (cell_data[3] == 0) {
          addWall(a,inc*row + inc - 1,inc*col+inc/2,1,inc);
          addRectangle(inc*row + inc - 1 - wallSize, inc*row + inc - 1 + wallSize,inc*col,inc*col+inc)
        }
      }
    }
  }
}

window.onload = function () {
var playerEl = document.querySelector("#camera").object3D;
playerEl.addEventListener('collide', function (e) {
  console.log('Player has collided with body #' + e.detail.body.id);

  //e.detail.target.el;  // Original entity (playerEl).
  //e.detail.body.el;    // Other entity, which playerEl touched.
  //e.detail.contact;    // Stats about the collision (CANNON.ContactEquation).
  //e.detail.contact.ni; // Normal (direction) of the collision (CANNON.Vec3).
});
var obj3d = document.querySelector("#camera").object3D;
console.log("aaaa");
AFRAME.registerComponent('listener', {
tick: function () {
  var x = document.querySelector("#camera").getAttribute('rotation').x;
  var angleobj = obj3d.getWorldDirection();
  angleobj.y = 0;
  var new_angleobj = angleobj.clone();
  var new_obj3d = obj3d.clone();
  new_obj3d.position.add(new_angleobj.multiplyScalar(0.004*x));  
  //console.log(new_angleobj.multiplyScalar(0.008*x));
  
  //obj3d.position.add(angleobj.multiplyScalar(0.008*x));
  console.log(new_obj3d.position.x,new_obj3d.position.z)
  if (!checkForCollision(new_obj3d.position.x,new_obj3d.position.z)) {
    obj3d.position.add(angleobj.multiplyScalar(0.004*x));  
  }
  //console.log(obj3d.position.x,obj3d.position.z)
  //document.querySelector("#camera").object3D.translateZ(-0.1);
}
});
var a = document.getElementById('a');
addMaze();
//addWall(a,15,15,10,1);

};
</script>
</html>
