<!doctype html>
  <head>
  <meta charset="utf-8">
  <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="room-obj" src="room.obj"></a-asset-item>
        <a-asset-item id="room-mtl" src="room.mtl"></a-asset-item>
      </a-assets>
      <a-assets>
        <a-asset-item id="avatar-obj" src="boy.obj"></a-asset-item>
      </a-assets>
      <a-entity id="cameraWrapper" position="0 2 10" rotation="0 0 0">
        <a-camera near="0.1" user-height="0" id="camera" listener></a-camera>
      </a-entity>
      <a-entity obj-model="obj: #room-obj; mtl: #room-mtl" scale="0.08 0.08 0.08" rotation="-90 0 0"></a-entity>
      <a-entity obj-model="obj: #avatar-obj; mtl:" scale="0.3 0.3 0.3" rotation="-90 0 0"></a-entity>
      <a-plane position="0 4 4" rotation="-90 0 -90" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>
  <script>
    window.onload = function () {
      /*
      var pos = document.querySelector('#camera').getAttribute('position');
      var previous_tilt = 0.0;
      var px = 0.0;
      var py = 0.0;
      var pz = 0.0;
      */
            var camp = document.querySelector("#cameraWrapper");
            var obj3d = document.querySelector("#camera").object3D;
        AFRAME.registerComponent('listener', {
          tick: function () {
            //console.log("NEW POSITIONS:")
            //console.log(this.el.getAttribute('position'));
            //console.log(this.el.getAttribute('rotation'));

          //var cameraEl = document.querySelector('#camera');
          /*
          var nx = camp.getAttribute('position').x;
          var ny = camp.getAttribute('position').y;
          var nz = camp.getAttribute('position').z;
          */
          var angleobj = obj3d.getWorldDirection();
          //console.log(angleobj);
          //var nrx = angleobj.x;
          //var nry = angleobj.y;
          //var nrz = angleobj.z;
            //camp.setAttribute('position', 'x',nx-0.01*nrx);
            //camp.setAttribute('position', 'y',ny+0.1*nry);
            //camp.setAttribute('position', 'x',nz-0.09*nry);
            //camp.setAttribute('position', 'z',nz-0.09*nry);
            var current_tilt = obj3d.quaternion.x;
            //console.log(current_tilt);
            angleobj.y = 0
            obj3d.parent.position.add(angleobj.multiplyScalar(current_tilt*0.1));
            //console.log(camp)
          //var camera = document.querySelector("a-camera");
          //var direction = new THREE.Vector3().copy(camera.getWorldDirection());
          //console.log(direction);
          //var stepFactor = 0.1;
          //console.log(direction);
          //camp.position.add(cameraEl.object3D.quaternion.multiplyScalar(stepFactor));
          }
        });

        /*
      document.querySelector('[camera]').addEventListener('componentchanged', function (evt) {
        return;
        var cameraEl = document.querySelector('#camera');
        var worldPos = new THREE.Vector3();
        worldPos.setFromMatrixPosition(cameraEl.object3D.matrixWorld);
        var cx = worldPos.x;
        var cy = worldPos.y;
        var cz = worldPos.z;
        var current_tilt = cameraEl.object3D.quaternion.x;
        var current_y = cameraEl.object3D.quaternion.y;
        //console.log('CAMERA JAW:', current_y);
        if(previous_tilt != current_tilt) {
          previous_tilt = current_tilt;
          //console.log('CAMERA TILT:', current_tilt);
        }
        //console.log('CAMERA POSITION X/Y/Z:', cx,cy,cz);
        if (px != cx || py != cy || pz != cz) {
          px = cx;
          py = cy;
          pz = cz;
          //console.log('CAMERA POSITION X/Y/Z:', cx,cy,cz);
        }a
        var worldPos = new THREE.Vector3();
        var quaternion = new THREE.Quaternion();
        worldPos.setFromMatrixPosition(cameraEl.object3D.matrixWorld);
        console.log('WORLD POSITION CAMERA',worldPos.x);
        console.log('WORLD ROTATION CAMERA',quaternion.x);
        if (evt.name === 'rotation') { 
          console.log('Entity has moved from POSITION', evt, 'to', evt, '!');
          return; 
        }
        if (evt.name === 'position') { 
          console.log('Entity has moved from POSITION', evt, 'to', evt, '!');
          return; 
        }
        return;
        if (evt.newData.y < 180) { 
            // ... 
        }
      });
        */
    };
  </script>
</html>
